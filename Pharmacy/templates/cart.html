{% extends 'base.html' %}
{% load static %}

{% block title %}Your Cart{% endblock %}

{% block content %}

<div class="cart-container">
  <h2>Your Shopping Cart</h2>

  {% if messages %}
  <ul class="messages">
    {% for message in messages %}
    <li style="color: green">{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %} {% if cart_items %}
  <table class="cart-table">
    <thead>
      <tr>
        <th>Medicine</th>
        <th>Quantity</th>
        <th>Price (Rs.)</th>
        <th>Subtotal (Rs.)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for item in cart_items %}

      <tr>
        <td>{{ item.product }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.price }}</td>
        <td>{{ item.total }}</td>
        <td>
          <form
            method="post"
            action="{% url 'remove_from_cart' %}"
            style="display: inline"
          >
            {% csrf_token %}
            <input
              type="hidden"
              name="medicine_id"
              value="{{ item.product.id }}"
            />
            <button type="submit" class="btn btn-sm btn-danger">Remove</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="cart-total"><strong>Total:</strong> Rs. {{ total_price }}</div>

  <div class="checkout-button" style="text-align: right; margin-top: 20px">
    {% if not show_form %}
    <form method="post" action="{% url 'view_cart' %}">
      {% csrf_token %}
      <input type="hidden" name="show_form" value="1" />
      <button type="submit" class="btn btn-primary">Proceed to Checkout</button>
    </form>
    {% endif %}
  </div>

  {% if show_form %}
  <hr />
  <h3>Enter Your Details to Confirm Order</h3>
  <form method="post" action="{% url 'view_cart' %}" class="checkout-form">
    {% csrf_token %}
    <div class="form-group">
      <label for="id_name">Name:</label>
      {{ form.name }}
    </div>
    <div class="form-group">
      <label for="id_phone">Phone:</label>
      {{ form.phone }}
    </div>
    <div class="form-group">
      <label for="id_address">Address:</label>
      {{ form.address }}
    </div>
    <button type="submit" class="btn btn-success" style="margin-top: 10px">
      Confirm Order
    </button>
  </form>
  {% endif %} {% else %}
  <p>Your cart is empty.</p>
  {% endif %}
</div>

<style>
  .cart-container {
    max-width: 800px;
    margin: 30px auto;
    padding: 20px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
  }
  .cart-container h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  .cart-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  .cart-table th,
  .cart-table td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #ddd;
  }
  .cart-table th {
    background-color: #f5f5f5;
  }
  .cart-total {
    text-align: right;
    font-size: 18px;
    margin-top: 10px;
  }
  .checkout-form {
    margin-top: 20px;
    background-color: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .checkout-form .form-group {
    margin-bottom: 15px;
  }
  .checkout-form input[type="text"],
  .checkout-form textarea {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
</style>
{% endblock %}
